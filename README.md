# Malware-Analysis-Zeus-Banking-Trojan
### Lab Setup for FlareVM and REMnux

#### Step 1: Download Necessary Software
1. **VirtualBox**: Download from the [Oracle VM VirtualBox](https://www.virtualbox.org/wiki/Downloads) website.
2. **Windows 10 Enterprise**: Download from the [Microsoft](https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise) website.
3. **REMnux**: Download the virtual appliance from the [REMnux](https://docs.remnux.org/install-distro/get-virtual-appliance.html) website.

#### Step 2: Setup Virtual Machine for FlareVM Using the Windows ISO File
1. Install Windows 10 Enterprise on a new virtual machine in VirtualBox.

#### Step 3: Disable Certain Windows Settings
1. **Change Proxy Settings**: 
   - Go to Proxy settings and turn off "Automatically detect settings".
2. **Disable Windows Defender**:
   - Go to Settings -> Update & Security -> Windows Security -> Virus & threat protection -> Manage settings -> Turn off Real-time protection.
3. **Setup Group Policy**:
   - Open "Edit group policy" from Windows search.
   - Navigate to Administrative Templates -> Windows Components -> Microsoft Defender Antivirus.
   - Enable "Turn off Microsoft Defender Antivirus".
   - Navigate to Network Connections -> Windows Defender Firewall.
     - For Domain Profile: Protect all network connections -> Disable.
     - For Standard Profile: Protect all network connections -> Disable.

#### Step 4: Create a Snapshot of the FlareVM
1. Create a snapshot in VirtualBox and rename it to "WIN10 BASE".

#### Step 5: Install FlareVM
1. Open PowerShell as an administrator.
2. Change directory to the desktop:
   ```
   cd Desktop
   ```
3. Paste and run the following script in PowerShell:
   ```
   (New-Object net.webclient).DownloadFile('https://raw.githubusercontent.com/mandiant/flare-vm/master/install.ps1',"$([Environment]::GetFolderPath('Desktop'))\install.ps1")
   ```
4. Unblock the file:
   ```
   Unblock-File .\install.ps1
   ```
5. Set the execution policy to unrestricted:
   ```
   Set-ExecutionPolicy Unrestricted
   ```
6. Run the script:
   ```
   .\install.ps1
   ```
7. Click OK when prompted. The script will download all the necessary packages.

#### Step 6: Import REMnux to VirtualBox
1. Import the REMnux virtual appliance into VirtualBox.

#### Step 7: Create a Network in VirtualBox
1. Go to Tools -> Create Network.
2. Set the IP address to `10.0.0.1` and apply the settings.
3. Set the DHCP server address to `10.0.0.2`.
   - Lower Address Bound: `10.0.0.3`
   - Upper Address Bound: `10.0.0.254`
   - Note: VirtualBox Host-only Ethernet Adapter will establish a connection between REMnux and FlareVM for communication.

#### Step 8: Configure REMnux
1. Open a terminal in REMnux and navigate to `/etc/inetsim`:
   ```
   cd /etc/inetsim
   ```
2. Edit the `inetsim.conf` file:
   ```
   sudo nano inetsim.conf
   ```
3. Uncomment the `start_service dns` line.
4. Change `service_bind_address` from `10.10.10.1` to `0.0.0.0`.
5. Change `dns_default_ip` from `10.10.10.1` to `10.0.0.4`.
6. Save changes and exit the editor.

#### Step 9: Review Failed Packages
1. Open `failed_packages.txt` from the desktop in the FlareVM after all packages have been downloaded.

#### Step 10: Download and Extract Sysinternals
1. Download Sysinternals from Microsoft.
2. Extract it to the following path:
   ```
   This PC -> Local Disk C -> ProgramData -> Microsoft -> Windows -> Start Menu -> Programs -> Tools
   ```

#### Step 11: Change Network Settings for VM Communication
1. Set the network to "Host-only Adapter" for both VMs (REMnux and FlareVM).

#### Step 12: Edit Ethernet Settings of FlareVM
1. Edit the DNS server of FlareVM's Ethernet settings to `10.0.0.4`.

#### Step 13: Test Network Connection
1. Ping the opposite IP address from each VM to check the connection.
SELF HOSTED LAB IS SETUP.

### Overview of the Project Analysis

#### Project Analysis Steps:
1. **Overview of Analysis Tools**
2. **Provision Lab**
3. **Conduct Analysis**
4. **Download Zeus Banking Trojan**
5. **Label Malware (hashes) & VirusTotal**
6. **Basic Static Analysis**
7. **Basic Dynamic Analysis**
8. **Report & IOCs (Indicators of Compromise)**

#### Pre-requisites:
- Malware Analysis Lab Built
- Snapshot of Base Image
- Established Internet Connection
- Zeus Banking Trojan Virus link: [Zeus Banking Trojan](https://github.com/ytisf/theZoo/tree/master/malware/Binaries/ZeusBankingVersion_26Nov2013)

### Overview of Analysis Tools:

#### 1. **VirusTotal**
   - **Purpose**: Assesses malicious files, domains, IP addresses, and URLs to detect malware.
   - **Usage**: Fingerprints malicious samples and measures functionality against security engines.

#### 2. **PeStudio**
   - **Purpose**: Statically analyzes malware and identifies artifacts of interest.
   - **Collected Information**:
     - Hashes
     - File Header
     - File Properties
     - Strings
     - Libraries Used
     - Imports

#### 3. **Floss**
   - **Purpose**: Extracts strings from executables using advanced static analysis to deobfuscate strings from malware binaries.
   - **Usage**: `floss malicious.exe`

#### 4. **Capa**
   - **Purpose**: Detects program capabilities and maps behavior to the MITRE ATT&CK framework.
   - **Output**: Displays what the program can potentially do.

#### 5. **Cutter**
   - **Purpose**: Reverse-engineering platform used to view assembly-level instructions and decompiled code.

#### 6. **INetSim**
   - **Purpose**: Simulates common internet services to analyze network behavior of malware samples.

#### 7. **Wireshark**
   - **Purpose**: Network packet sniffer and analyzer used for network troubleshooting and packet analysis.

#### 8. **Process Monitor (Procmon)**
   - **Part of**: Sysinternals Suite
   - **Purpose**: Monitors and displays real-time information on the Windows filesystem.
   - **Captured Events**:
     - Registry
     - Filesystem
     - Network
     - Processes
     - Profiling Events

#### 9. **YARA**
   - **Purpose**: Classifies and identifies malware samples by creating rules based on textual or binary patterns.
   - **Example Rule**:
     ```yara
     rule Zeus_IOC {
       strings:
         $file_name = "invoice_2318362983713_823931342io.pdf.exe" ascii
         $PE_magic_byte = "MZ"
       condition:
         $PE_magic_byte at 0 and $file_name
     }
     ```

### Steps to Conduct Analysis:

#### 1. **Provision Lab**
   - Ensure the malware analysis lab is set up and ready for analysis.

#### 2. **Conduct Analysis**
   - Perform both static and dynamic analysis using the tools listed.

#### 3. **Download Zeus Banking Trojan**
   - Download from the provided link.

#### 4. **Label Malware (Hashes) & VirusTotal**
   - Label the malware samples using their hashes and upload them to VirusTotal for initial assessment.

#### 5. **Basic Static Analysis**
   - Use PeStudio, Floss, and Capa to perform a static analysis on the malware samples.

#### 6. **Basic Dynamic Analysis**
   - Use tools like INetSim, Wireshark, and Procmon to analyze the behavior of the malware in a controlled environment.

#### 7. **Report & IOCs**
   - Generate a comprehensive report including all findings and Indicators of Compromise (IOCs) based on the analysis performed.
